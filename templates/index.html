<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Using Template</title>
    <style>
        html, body {
            height: 100%;
        }
        div#animes-container {
            height: 80%;
            width: 600px;
            overflow: scroll;
        }
        i {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>あにそーん</h1>
    <div id="animes-container">
        <div id="animes">
        </div>
    </div>
    <script type="text/template" id="anime-template">
        <b><%- Title %></b>
        <ul>
            <li>OP
                <ul>
                <% for (var i=0;i<music.op.length;i++){ %>
                    <li>
                        <i><%- music.op[i].mtitle %></i>
                    </li>
                <% } %>
                </ul>
            </li>
            <li>ED
                <ul>
                <% for (var i=0;i<music.ed.length;i++){ %>
                    <li>
                        <i><%- music.ed[i].mtitle %></i>
                    </li>
                <% } %>
                </ul>
            </li>
        </ul>
    </script>
</body>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
<!--script type="text/javascript" src="http://otiai10.com/json2.js"></script-->
<script type="text/javascript" src="http://backbonejs.org/backbone-min.js"></script>
<script type="text/javascript" charset="utf-8" id="preload">
(function(){
    var animes = {{ list }};
    var __anisons = [];
    var tmp_index = 0;
    for (var i=0;i<animes.length;i++) {
        var atitle = animes[i]['Title'];
        for (var j=0;j<animes[i].music.op.length;j++) {
            tmp_index++;
            console.log("idx\t", tmp_index, "\t", atitle, '--', animes[i].music.op[j].mtitle);
        }
        for (var j=0;j<animes[i].music.ed.length;j++) {
            tmp_index++;
            console.log("idx\t", tmp_index, "\t", atitle, '--', animes[i].music.ed[j].mtitle);
        }
    }
    var AnimeView = Backbone.View.extend({
        tagName  : 'li',
        template : _.template($('#anime-template').html()),
        render   : function(){
            var tpl = this.template(this.model.attributes);
            this.$el.html(tpl);
            return this;
        },
        events : {
        },
        diapear : function(e){
            alert('diapear');
            console.log(e);
        },
    });
    var AnimesView = Backbone.View.extend({
        tagName : 'ul',
        render  : function(){
            this.collection.each(function(_anime){
                var animeView = new AnimeView({model:_anime});
                this.$el.append(animeView.render().el);
            },this);
            return this;
        },
    });

    var __animes = new Backbone.Collection(animes);

    var animesView = new AnimesView({collection : __animes});
    $('#animes').html(animesView.render().el);

})();
</script>
</html>
